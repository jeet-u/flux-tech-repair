syntax = "proto3";

package api_interface;

message InputTemplate {
    bytes input = 1; // TTF/WOFF2 file buffer
    optional string out_dir = 2; // Folder to place files after splitting

    // ====== Build Output Configuration ======

    optional CssProperties css = 5; // CSS configuration
    optional string target_type = 6; // Target type
    repeated bytes subsets = 7; // Subsets
    optional int32 chunk_size = 9; // Package size
    optional float chunk_size_tolerance = 10; // Package size tolerance
    optional int32 max_allow_subsets_count = 11; // Maximum allowed subset count

    optional bool test_html = 13; // Whether to generate test HTML
    optional bool reporter = 14; // Whether to generate reporter.bin
    optional PreviewImage preview_image = 15; // Preview image

    optional string rename_output_font = 18; // Rename output font
    optional string build_mode = 20; // TODO Build mode

    // ====== Pre-packaging Optimization Configuration =======

    optional bool language_areas = 8; // Whether to perform language region optimization
    optional bool multi_threads = 21; // TODO Whether to use multi-threading
    optional bool font_feature = 22; // Whether to enable font features
    optional bool reduce_mins = 23; // Whether to reduce minimum packages
    optional bool auto_subset = 24; // Whether to auto subset
    optional bool subset_remain_chars = 25; // Whether to automatically add undeclared characters

    // CSS property configuration
    message CssProperties {
        optional string font_family = 1; // Font family name
        optional string font_weight = 2; // Font weight
        optional string font_style = 3; // Font style
        optional string font_display = 4; // Font display method
        repeated string local_family = 5; // Local font family name
        repeated PolyfillType polyfill = 6; // Polyfill type

        // Comment properties
        
        optional bool comment_base = 11; // Basic comment
        optional bool comment_name_table = 12; // Name table comment
        optional bool comment_unicodes = 13; // Unicode comment
        optional bool compress = 8; // Whether to compress
        optional string file_name = 9; // File name
    }

    // Polyfill type
    message PolyfillType {
        string name = 1; // Name
        string format = 2; // Format
    }

    // Preview image
    message PreviewImage {
        string text = 1; // Text displayed in SVG
        string name = 2; // Name of SVG file
    }
}

enum EventName {
  UNSPECIFIED = 0; 
  OUTPUT_DATA = 1; // "output_data"
  END = 2;         // "end"
}

message EventMessage {
    EventName event = 1;
    string message = 2;
    optional bytes data = 3;
}
message MultiMessages {
    repeated EventMessage messages = 1;
}
message OutputReport {
    string version = 1; // Version number
    Css css = 2; // CSS-related information, can be used directly
    string platform = 3; // Platform information, Rust build platform

    BundleMessage bundle_message = 24; // Build message
    repeated NameTable name_table = 25; // Name table information
    repeated SubsetDetail subset_detail = 26; // Subset details

    message NameTable {
        string platform = 1; // Platform
        string language = 2; // Language
        string name = 3; // Name
        string value = 4; // Value
    }

    message SubsetDetail {
        uint32 id = 1; // ID
        string hash = 2; // Hash value
        string file_name = 6; // File name
        uint32 bytes = 3; // Byte count
        repeated uint32 chars = 4; // Character array
        uint32 duration = 5; // Build time
    }

    message BundleMessage {
        uint32 origin_size = 1; // Original size
        uint32 bundled_size = 2; // Output size
        uint32 origin_bytes = 3; // Original bytes
        uint32 bundled_bytes = 4; // Output bytes
    }

    message Css {
        string family = 1; // Font family
        string style = 2; // Style
        string weight = 3; // Font weight
        string display = 4; // Display method
    }
}
